# Render Deployment Checklist

## ‚úÖ Completed Fixes

### 1. Backend Folder Path Fixed
- **Issue**: `render.yaml` referenced `backend` folder, but actual folder is `GWbackend`
- **Fix**: Updated `render.yaml` buildCommand and startCommand to use `GWbackend`

### 2. API Configuration Verified
- **Frontend API URL**: `src/services/api.ts` correctly uses `import.meta.env.VITE_API_URL || 'https://gwbackend.onrender.com/api'`
- **Backend Routes**: All routes match frontend API calls:
  - `/api/auth/*` - User authentication ‚úÖ
  - `/api/admin/*` - Admin operations ‚úÖ
  - `/api/videos/*` - Video uploads ‚úÖ
  - `/api/payments/*` - Payment processing ‚úÖ

### 3. CORS Configuration
- **Backend** (`GWbackend/src/server.ts`): Allows:
  - `process.env.FRONTEND_URL`
  - `https://gwfrontend.onrender.com`
  - `http://localhost:3000` (dev fallback)
- **Status**: ‚úÖ Production-ready

### 4. Environment Variables
- **Backend Required** (set in Render dashboard):
  - `NODE_ENV=production`
  - `PORT=5000`
  - `JWT_SECRET` (auto-generated by Render)
  - `DATABASE_URL` (from PostgreSQL service)
  - `PAYSTACK_SECRET_KEY` (manual)
  - `FRONTEND_URL` (set after frontend deployment, e.g., `https://gwfrontend.onrender.com`)
  - `B2_APPLICATION_KEY_ID` (Backblaze B2 - for video storage)
  - `B2_APPLICATION_KEY` (Backblaze B2)
  - `B2_BUCKET_NAME` (Backblaze B2)
  - `B2_ENDPOINT` (Backblaze B2)

- **Frontend Required** (set in Render Static Site settings):
  - `VITE_API_URL=https://gwbackend.onrender.com/api` (optional - defaults to this)

### 5. Security Files Excluded
- `.gitignore` properly excludes:
  - `.env` files ‚úÖ
  - `node_modules/` ‚úÖ
  - `dist/` ‚úÖ
  - Uploads and logs ‚úÖ

## üìã Deployment Steps

### Backend Deployment (Web Service)

1. **Connect Repository** to Render
2. **Select Render Blueprint** (`GWbackend/render.yaml`)
   - This will create both the backend service and PostgreSQL database
3. **Manual Environment Variables** to set in Render dashboard:
   ```
   FRONTEND_URL=https://gwfrontend.onrender.com
   PAYSTACK_SECRET_KEY=sk_live_...
   B2_APPLICATION_KEY_ID=...
   B2_APPLICATION_KEY=...
   B2_BUCKET_NAME=gwcontest-videos
   B2_ENDPOINT=https://s3.us-west-000.backblazeb2.com
   ```
4. **Build Settings** (should auto-detect from render.yaml):
   - Build Command: `cd GWbackend && npm install && npm run build`
   - Start Command: `cd GWbackend && npm start`
5. **Database**: Will be created automatically by render.yaml blueprint

### Frontend Deployment (Static Site)

1. **Create Static Site** in Render dashboard
2. **Connect Repository**
3. **Build Settings**:
   - Build Command: `npm install && npm run build`
   - Publish Directory: `dist`
4. **Environment Variables** (optional):
   - `VITE_API_URL=https://gwbackend.onrender.com/api` (if different from default)

### Post-Deployment Checklist

- [ ] Test backend health endpoint: `https://gwbackend.onrender.com/api/health`
- [ ] Verify CORS allows frontend origin
- [ ] Test user registration/login
- [ ] Test admin login (requires admin user creation first)
- [ ] Test video upload (requires Backblaze B2 credentials)
- [ ] Test payment flow (requires Paystack credentials)
- [ ] Update frontend environment variable `VITE_API_URL` if needed
- [ ] Create admin user via script: `node GWbackend/scripts/create-admin.js`

## üîç Connection Verification

### Frontend ‚Üí Backend Connection
- **Frontend API Base URL**: `https://gwbackend.onrender.com/api` ‚úÖ
- **Backend CORS**: Allows `https://gwfrontend.onrender.com` ‚úÖ
- **All Routes Match**: Verified ‚úÖ

### Backend ‚Üí Database Connection
- **Uses**: `DATABASE_URL` from PostgreSQL service ‚úÖ
- **SSL**: Enabled automatically for cloud databases ‚úÖ
- **Connection Pool**: 20 max connections, 30s timeout ‚úÖ

### Backend ‚Üí External Services
- **Backblaze B2**: Required for video storage (set via env vars)
- **Paystack**: Required for payments (set via `PAYSTACK_SECRET_KEY`)

## ‚ö†Ô∏è Important Notes

1. **Backend folder name**: The backend is in `GWbackend/` folder (not `backend/`) - this has been fixed in `render.yaml`

2. **Admin Login**: Backend has `/api/admin/login` endpoint, but frontend currently uses `/api/auth/login` for all logins. This may need review if separate admin login flow is needed.

3. **Backblaze B2**: Video storage requires Backblaze B2 credentials. Without these, video uploads will fail.

4. **Database Schema**: Ensure `schema.sql` has been run or will be run during deployment to create required tables.

5. **CORS Warning**: Backend CORS currently logs warnings but allows all origins in production (lines 59-61 in `server.ts`). Consider tightening this for better security.

## üöÄ Ready for Deployment

All critical connection issues have been addressed. The frontend and backend are properly configured to communicate via the production API URL. The `render.yaml` file has been corrected to use the proper `GWbackend` folder path.
